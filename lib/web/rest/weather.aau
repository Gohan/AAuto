import web.rest.jsonLiteClient;
import web.rest.xmlClient;
namespace web.rest.weather;

get = function(p,c){ 
	if( !c  ) c = p;
	var restClient = ..web.rest.jsonLiteClient();
	var weather = restClient.declareApi("http://m.weather.com.cn/data/{0}.html")
	if( ..string.endWith(p,"省",true) ) p = ..string.left(p,-3)
	if( ..string.endWith(p,"市",true) ) p = ..string.left(p,-3)
	if( ..string.endWith(c,"市",true) ) c = ..string.left(c,-3)
	var code = cityCode[[p]][[c]]
	var w = code ? weather[ code ].get()[["weatherinfo"]]
	restClient._http.close();
	return w;
}
	
cityCode = { 
天津={ 西青="101030500";北辰="101030600";大港="101031200";天津="101030100";宝坻="101030300";蓟县="101031400";武清="101030200";东丽="101030400";津南="101031000";静海="101030900";宁河="101030700";塘沽="101031100";汉沽="101030800" };
福建={ 南平="101230901";宁德="101230301";三明="101230801";泉州="101230501";厦门="101230201";晋江="101230509";莆田="101230401";漳州="101230601";龙岩="101230701";福州="101230101" };
海南={ 定安="101310209";五指山="101310222";昌江="101310206";文昌="101310212";澄迈="101310204";陵水="101310216";西沙="101310217";琼山="101310102";东方="101310202";三亚="101310201";屯昌="101310210";临高="101310203";琼中="101310208";乐东="101310221";万宁="101310215";保亭="101310214";琼海="101310211";白沙="101310207";儋州="101310205";南沙岛="101310220";海口="101310101" };
上海={ 浦东="101021300";上海="101020100";徐家汇="101021200";嘉定="101020500";宝山="101020300";金山="101020700";南汇="101020600";青浦="101020800";松江="101020900";崇明="101021100";奉贤="101021000";闵行="101020200" };
广西={ 防城港="101301401";百色="101301001";贺州="101300701";崇左="101300201";玉林="101300901";北海="101301301";钦州="101301101";河池="101301201";贵港="101300801";梧州="101300601";来宾="101300401";南宁="101300101";柳州="101300301";桂林="101300501" };
安徽={ 亳州="101220901";合肥="101220101";铜陵="101221301";黄山="101221001";阜阳="101220801";宣城="101221401";芜湖="101220301";池州="101221701";巢湖="101221601";蚌埠="101220201";安庆="101220601";六安="101221501";淮南="101220401";淮北="101221201";滁州="101221101";马鞍山="101220501";宿州="101220701" };
吉林={ 白山="101060901";白城="101060601";吉林="101060201";四平="101060401";延吉="101060301";辽源="101060701";通化="101060501";松原="101060801";长春="101060101" };
黑龙江={ 齐齐哈尔="101050201";双鸭山="101051301";佳木斯="101050401";鹤岗="101051201";牡丹江="101050301";七台河="101051002";哈尔滨="101050101";黑河="101050601";大兴安岭="101050701";大庆="101050901";鸡西="101051101";伊春="101050801";绥化="101050501" };
江苏={ 常州="101191101";宿迁="101191301";苏州="101190401";镇江="101190301";盐城="101190701";淮安="101190901";扬州="101190601";南京="101190101";泰州="101191201";徐州="101190801";连云港="101191001";无锡="101190201";南通="101190501" };
山西={ 晋城="101100601";临汾="101100701";晋中="101100401";朔州="101100901";运城="101100801";太原="101100101";大同="101100201";吕梁="101101100";阳泉="101100301";长治="101100501";忻州="101101001" };
湖南={ 衡阳="101250401";湘潭="101250201";岳阳="101251001";吉首="101251501";长沙="101250101";张家界="101251101";黔阳="101251301";株洲="101250301";怀化="101251201";永州="101251401";邵阳="101250901";郴州="101250501";益阳="101250700";娄底="101250801";常德="101250601" };
台湾={ 高雄="101340201";台中="101340401";台北县="101340101" };
湖北={ 咸宁="101200701";黄冈="101200501";襄樊="101200201";荆门="101201401";十堰="101201101";天门="101201501";武汉="101200101";恩施="101201001";潜江="101201701";鄂州="101200301";荆州="101200801";随州="101201301";黄石="101200601";孝感="101200401";仙桃="101201601";宜昌="101200901";神农架="101201201" };
西藏={ 阿里="101140701";昌都="101140501";日喀则="101140201";林芝="101140401";山南="101140301";拉萨="101140101";那曲="101140601" };
内蒙古={ 阿拉善左旗="101081201";呼伦贝尔="101081000";包头="101080201";通辽="101080501";锡林浩特="101080901";呼和浩特="101080101";赤峰="101080601";鄂尔多斯="101080701";乌兰浩特="101081101";集宁="101080401";乌海="101080301";临河="101080801" };
宁夏={ 银川="101170101";吴忠="101170301";石嘴山="101170201";固原="101170401";中卫="101170501" };
贵州={ 六盘水="101260801";安顺="101260301";兴义="101260906";贵阳="101260101";凯里="101260501";铜仁="101260601";毕节="101260701";遵义="101260201";都匀="101260401" };
江西={ 景德镇="101240801";上饶="101240301";南昌="101240101";九江="101240201";鹰潭="101241101";宜春="101240501";抚州="101240401";赣州="101240701";新余="101241001";吉安="101240601";萍乡="101240901" };
浙江={ 宁波="101210401";衢州="101211001";湖州="101210201";温州="101210701";杭州="101210101";丽水="101210801";金华="101210901";绍兴="101210501";台州="101210601";嘉兴="101210301";舟山="101211101" };
新疆={ 库尔勒="101130601";阿拉尔="101130701";喀什="101130901";塔城="101131101";克拉玛依="101130201";昌吉="101130401";石河子="101130301";阿勒泰="101131401";和田="101131301";哈密="101131201";博乐="101131601";阿克苏="101130801";乌鲁木齐="101130101";伊宁="101131001";阿图什="101131501";吐鲁番="101130501" };
陕西省={ 榆林="101110401";商洛="101110601";宝鸡="101110901";汉中="101110801";渭南="101110501";安康="101110701";铜川="101111001";延安="101110300";咸阳="101110200";西安="101110101" };
重庆={ 涪陵="101041400";江津="101040500";潼南="101042100";云阳="101041700";奉节="101041900";城口="101041600";长寿="101041000";沙坪坝="101043700";大足="101042600";丰都="101043000";綦江="101043300";北碚="101040800";彭水="101043200";璧山="101042900";巫溪="101041800";巴南="101040900";酉阳="101043400";永川="101040200";秀山="101043600";铜梁="101042800";武隆="101043100";巫山="101042000";重庆="101040100";荣昌="101042700";垫江="101042200";忠县="101042400";合川="101040300";梁平="101042300";石柱="101042500";渝北="101040700";万盛="101040600";开县="101041500";万州天城="101041200";黔江="101041100";万州龙宝="101041300";南川="101040400" };
辽宁={ 丹东="101070601";朝阳="101071201";抚顺="101070401";本溪="101070501";沈阳="101070101";鞍山="101070301";铁岭="101071101";锦州="101070701";葫芦岛="101071401";大连="101070201";盘锦="101071301";阜新="101070901";辽阳="101071001";营口="101070801" };
甘肃={ 兰州="101160101";金昌="101160601";武威="101160501";临夏="101161101";嘉峪关="101161401";酒泉="101160801";武都="101161001";张掖="101160701";白银="101161301";合作="101161201";定西="101160201";平凉="101160301";天水="101160901";庆阳="101160401" };
青海={ 海北="101150801";海西="101150701";玉树="101150601";海南="101150401";果洛="101150501";西宁="101150101";海东="101150201";黄南="101150301" };
四川={ 眉山="101271501";绵阳="101270401";内江="101271201";阿坝="101271901";达州="101270601";凉山="101271601";自贡="101270301";巴中="101270901";广安="101270801";乐山="101271401";遂宁="101270701";资阳="101271301";攀枝花="101270201";广元="101272101";宜宾="101271101";雅安="101271701";成都="101270101";泸州="101271001";德阳="101272001";甘孜="101271801";南充="101270501" };
北京={ 北京="101010100";八达岭="101011600";丰台="101010900";密云="101011300";大兴="101011100";延庆="101010800";海淀="101010200";通州="101010600";汤河口="101011800";佛爷顶="101011700";朝阳="101010300";怀柔="101010500";北京城区="101012200";门头沟="101011400";斋堂="101012000";昌平="101010700";密云上甸子="101011900";房山="101011200";霞云岭="101012100";平谷="101011500";顺义="101010400";石景山="101011000" };
山东={ 莱芜="101121601";威海="101121301";烟台="101120501";济南="101120101";滨州="101121101";聊城="101121701";青岛="101120201";潍坊="101120601";淄博="101120301";泰安="101120801";临沂="101120901";菏泽="101121001";济宁="101120701";德州="101120401";枣庄="101121401";日照="101121501";东营="101121201" };
河北={ 张家口="101090301";石家庄="101090101";衡水="101090801";承德="101090402";保定="101090201";廊坊="101090601";唐山="101090501";邯郸="101091001";秦皇岛="101091101";邢台="101090901";沧州="101090701" };
云南={ 文山="101290601";德宏="101291501";昆明="101290101";怒江="101291201";玉溪="101290701";香格里拉="101291301";昭通="101291001";普洱="101290901";楚雄="101290801";曲靖="101290401";景洪="101291601";丽江="101291401";红河="101290301";大理="101290201";保山="101290501";临沧="101291101" };
广东={ 汕尾="101282101";汕头="101280501";河源="101281201";深圳="101280601";珠海="101280701";广州="101280101";梅州="101280401";惠州="101280301";阳江="101281801";韶关="101280201";清远="101281301";茂名="101282001";揭阳="101281901";东莞="101281601";中山="101281701";云浮="101281401";潮州="101281501";湛江="101281001";肇庆="101280901";佛山="101280800";江门="101281101" };
河南={ 信阳="101180601";焦作="101181101";周口="101181401";新乡="101180301";鹤壁="101181201";平顶山="101180501";郑州="101180101";驻马店="101181601";漯河="101181501";开封="101180801";安阳="101180201";三门峡="101181701";商丘="101181001";济源="101181801";洛阳="101180901";濮阳="101181301";南阳="101180701";许昌="101180401" }
}

/*
图像接口说明(建议将图像下载到本地)
http://m.weather.com.cn/img/c0.gif
http://m.weather.com.cn/img/b0.gif
http://www.weather.com.cn/m/i/weatherpic/29x20/d0.gif
http://www.weather.com.cn/m2/i/icon_weather/29x20/n00.gif
这个图就是天气现象0（晴）的图片，其他天气现象的图片依此类推，99表示图片与前一天相同。
c打头的图片是20*20像素的，
b打头的是50*46像素的，
d打头的是反白的图标，29*20像素，
n打头的是夜间反白图标，29*20像素，
*/

/**intellisense(web.rest)
weather = 气象局接口
weather.get( = 返回天气信息
weather.get(.("省","市") = 参数必须指定省市名
weather.get() = !web_api_weather.
end intellisense**/

/**intellisense(!web_api_weather)
city = 城市
date_y = 日期
date = 农历日期
week = 星期
fchh = 更新点时间
cityid = 地区ID
temp1 = 今日最低温、最高温\n在更新点之前是今日最高温到午夜的最低温，在更新点之后是今日午夜的最低温到明日的最高温
temp2 = 第2天最低温、最高温
temp3 = 第3天最低温、最高温
temp4 = 第4天最低温、最高温
temp5 = 第5天最低温、最高温
temp6 = 第6天最低温、最高温
tempF1 = 第1天最低、最高华氏温度
tempF2 = 第2天最低、最高华氏温度
tempF3 = 第3天最低、最高华氏温度
tempF4 = 第4天最低、最高华氏温度
tempF5 = 第5天最低、最高华氏温度
tempF6 = 第6天最低、最高华氏温度
weather1 = 天气描述
weather2 = 天气描述
weather3 = 天气描述
weather4 = 天气描述
weather5 = 天气描述
weather6 = 天气描述
img1 = 天气图片
img2 = 天气图片
img3 = 天气图片
img4 = 天气图片
img5 = 天气图片
img6 = 天气图片
img7 = 天气图片
img8 = 天气图片
img9 = 天气图片
img10 = 天气图片同
img11 = 天气图片
img12 = 天气图片
img_single = 天气图片,
img_title1 = 天气图片描述
img_title2 = 天气图片描述
img_title3 = 天气图片描述
img_title4 = 天气图片描述
img_title5 = 天气图片描述
img_title6 = 天气图片描述,
img_title7 = 天气图片描述
img_title8 = 天气图片描述
img_title9 = 天气图片描述
img_title10 = 天气图片描述
img_title11 = 天气图片描述
img_title12 = 天气图片描述
img_title_single = 天气图片描述
wind1 = 风力风向描述
wind2 = 风力风向描述
wind3 = 风力风向描述
wind4 = 风力风向描述
wind5 = 风力风向描述
wind6 = 风力风向描述
fx1 = 今日风向
fx2 = 明日风向
fl1 = 风力
fl2 = 风力
fl3 = 风力
fl4 = 风力
fl5 = 风力
fl6 = 风力
index = 一天舒适度
index_d = 天气建议
index_uv = 一天的紫外线指数
index48 = 48小时舒适度
index48_d = 48小时天气建议
index48_uv = 48小时紫外线指数
index_xc = 洗车指数
index_tr = 旅游指数
index_co = 舒适度指数
index_cl = 晨练指数
index_ls = 晾晒指数
index_ag = 息斯敏过敏气象指数
end intellisense**/
